name: Slack Notification

on:
  push:
    branches:
      - version  # Replace with your branch name
  pull_request:
    branches:
      - version  # Replace with your branch name

jobs:
  Update-Helm-Charts:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Update Helm Charts
        run: |
          echo "Updating Helm Charts..."
          # Replace this with your actual update steps
          # Simulating a failure for demonstration
          if [ "$RANDOM" -gt 20000 ]; then
            echo "Simulating a failure"
            exit 1
          fi

      - name: Set Job Status
        id: job-status
        run: |
          echo "job_status=${{ job.status }}" >> $GITHUB_ENV
          echo "job_name=Update-Helm-Charts" >> $GITHUB_ENV

  notify:
    runs-on: ubuntu-latest
    needs: Update-Helm-Charts

    steps:
      - name: Send Slack Notification
        if: always()
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          JOB_STATUS: ${{ env.job_status }}
          JOB_NAME: ${{ env.job_name }}
        run: |
          if [ "${{ env.JOB_STATUS }}" == "success" ]; then
            STATUS_MESSAGE="GitHub Actions job '${{ env.JOB_NAME }}' succeeded üéâ"
          else
            STATUS_MESSAGE="GitHub Actions job '${{ env.JOB_NAME }}' failed ‚ùå"
          fi

          curl -X POST -H 'Content-type: application/json' --data '{"text":"'"${STATUS_MESSAGE}"'"}' $SLACK_WEBHOOK_URL
      
